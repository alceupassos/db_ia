module.exports=[18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},837,(e,t,a)=>{"use strict";t.exports=e.r(70782).vendored["react-rsc"].ReactServerDOMTurbopackServer},68250,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"registerServerReference",{enumerable:!0,get:function(){return r.registerServerReference}});let r=e.r(837)},70495,(e,t,a)=>{"use strict";function r(e){for(let t=0;t<e.length;t++){let a=e[t];if("function"!=typeof a)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof a}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"ensureServerEntryExports",{enumerable:!0,get:function(){return r}})},79292,e=>{"use strict";var t=e.i(68250),a=e.i(68937),r=e.i(70495);let n=(0,a.createClient)("https://uoqzxsfdxlqpbujsklfn.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function i(e){let t=n.from("demandas_juridicas").select("*").order("data_solicitacao",{ascending:!1,nullsFirst:!1});e?.status&&"all"!==e.status&&(t=t.eq("status",e.status)),e?.responsavel&&"all"!==e.responsavel&&(t=t.eq("responsavel",e.responsavel)),e?.cliente&&"all"!==e.cliente&&(t=t.eq("cliente_nome",e.cliente)),e?.search&&(t=t.or(`demanda.ilike.%${e.search}%,cliente_nome.ilike.%${e.search}%,observacoes.ilike.%${e.search}%`));let{data:a,error:r}=await t;if(r)throw r;return a}async function s(e){let{data:t,error:a}=await n.from("demandas_juridicas").select("*").eq("id",e).single();if(a)throw a;return t}async function o(e){let{data:t,error:a}=await n.from("demandas_juridicas").insert(e).select().single();if(a)throw a;return t}async function c(e,t){let{data:a,error:r}=await n.from("demandas_juridicas").update(t).eq("id",e).select().single();if(r)throw r;return a}async function l(e){let{error:t}=await n.from("demandas_juridicas").delete().eq("id",e);if(t)throw t}async function d(){let{data:e}=await n.from("demandas_juridicas").select("status");if(!e)return{total:0,pendentes:0,emAndamento:0,concluidos:0};let t=e.length,a=e.filter(e=>"PENDENTE"===e.status).length;return{total:t,pendentes:a,emAndamento:e.filter(e=>"EM ANDAMENTO"===e.status).length,concluidos:e.filter(e=>"CONCLUÍDO"===e.status).length}}async function u(){let{data:e,error:t}=await n.from("demandas_juridicas").select("responsavel").order("responsavel");if(t)throw t;return[...new Set(e.map(e=>e.responsavel))].filter(Boolean)}async function f(){let{data:e,error:t}=await n.from("demandas_juridicas").select("cliente_nome").order("cliente_nome");if(t)throw t;return[...new Set(e.map(e=>e.cliente_nome))].filter(Boolean)}async function p(e){let{data:t,error:a}=await n.from("arquivos_demanda").select("*").eq("demanda_id",e).order("created_at",{ascending:!1});if(a)throw a;return t}async function m(e,t){let{data:a,error:r}=await n.from("arquivos_demanda").insert({demanda_id:e,...t}).select().single();if(r)throw r;return a}async function v(e,t,a){let{data:r,error:i}=await n.from("demandas_juridicas").update({[t]:a}).eq("id",e).select().single();if(i)throw i;return r}async function h(e){let{error:t}=await n.from("arquivos_demanda").delete().eq("id",e);if(t)throw t}async function g(e,t){let{data:a,error:r}=await n.from("arquivos_demanda").update(t).eq("id",e).select().single();if(r)throw r;return a}async function _(e,t){let a=t.get("file");if(!a)throw Error("Nenhum arquivo enviado");let r=`${e}/${Date.now()}-${a.name}`,{data:i,error:s}=await n.storage.from("arquivos-juridico").upload(r,a,{cacheControl:"3600",upsert:!1});if(s)throw s;let{data:o}=n.storage.from("arquivos-juridico").getPublicUrl(r),{data:c,error:l}=await n.from("arquivos_demanda").insert({demanda_id:e,nome:a.name,tipo:a.type.split("/")[1]?.toUpperCase()||"ARQUIVO",mime_type:a.type,supabase_path:i.path,storage_url:o.publicUrl}).select().single();if(l)throw l;try{let e=process.env.NEXT_PUBLIC_APP_URL||process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"http://localhost:3000",t=await fetch(`${e}/api/juridico/analisar-arquivo`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({arquivoId:c.id,arquivoNome:a.name,storageUrl:o.publicUrl,mimeType:a.type})});t.ok||console.warn("Análise de arquivo retornou erro:",t.status)}catch(e){console.error("Erro ao analisar arquivo com IA:",e)}return c}async function b(e){let{data:t,error:a}=await n.from("arquivos_demanda").select("supabase_path").eq("id",e).single();if(a)throw a;t?.supabase_path&&await n.storage.from("arquivos-juridico").remove([t.supabase_path]);let{error:r}=await n.from("arquivos_demanda").delete().eq("id",e);if(r)throw r}async function w(){let{data:e,error:t}=await n.from("demandas_juridicas").select("status");if(t)throw t;let a={PENDENTE:0,"EM ANDAMENTO":0,CONCLUÍDO:0,Cancelado:0};return e?.forEach(e=>{e.status in a&&a[e.status]++}),Object.entries(a).map(([e,t])=>({status:e,count:t}))}async function R(){let{data:e,error:t}=await n.from("demandas_juridicas").select("cliente_nome");if(t)throw t;let a={};return e?.forEach(e=>{let t=e.cliente_nome||"Sem cliente";a[t]=(a[t]||0)+1}),Object.entries(a).map(([e,t])=>({cliente:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,10)}async function E(){let{data:e,error:t}=await n.from("arquivos_demanda").select("categoria");if(t)throw t;let a={};return e?.forEach(e=>{let t=e.categoria||"Sem categoria";a[t]=(a[t]||0)+1}),Object.entries(a).map(([e,t])=>({categoria:e,count:t}))}async function y(){let{data:e,error:t}=await n.from("demandas_juridicas").select("created_at, status").order("created_at",{ascending:!0});if(t)throw t;let a={};return e?.forEach(e=>{if(!e.created_at)return;let t=new Date(e.created_at),r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;a[r]||(a[r]={criadas:0,concluidas:0}),a[r].criadas++,"CONCLUÍDO"===e.status&&a[r].concluidas++}),Object.entries(a).map(([e,t])=>({mes:e,...t})).slice(-12)}async function x(e=20){let{data:t,error:a}=await n.from("demandas_juridicas").select("id, demanda, status, created_at, updated_at, cliente_nome").order("updated_at",{ascending:!1}).limit(e);if(a)throw a;return t?.map(e=>({id:e.id,tipo:"demanda",titulo:e.demanda,cliente:e.cliente_nome,status:e.status,data:e.updated_at||e.created_at,descricao:`Status: ${e.status}`}))||[]}async function S(){let e=new Date;e.setHours(0,0,0,0);let{data:t,error:a}=await n.from("demandas_juridicas").select("id, demanda, cliente_nome, prazo, data_entrega, data_fim_contrato, data_pagamento").or("prazo.is.not.null,data_entrega.is.not.null,data_fim_contrato.is.not.null,data_pagamento.is.not.null");if(a)throw a;let r=[];return t?.forEach(t=>{let a=(a,n,i)=>{let s=t[a];if(!s)return;let o=new Date(s);if(o.setHours(0,0,0,0),o>=e){let c=Math.ceil((o.getTime()-e.getTime())/864e5);if(c<=7){let e="baixa";c<=1?e="alta":c<=3&&(e="media"),r.push({id:`${t.id}-${a}`,tipo:n,titulo:`${i}: ${t.demanda}`,descricao:`Cliente: ${t.cliente_nome}`,data:s,diasRestantes:c,urgencia:e})}}};a("prazo","prazo","Prazo"),a("data_entrega","entrega","Data de Entrega"),a("data_fim_contrato","fim_contrato","Fim de Contrato"),a("data_pagamento","pagamento","Data de Pagamento")}),r.sort((e,t)=>e.diasRestantes-t.diasRestantes)}async function q(e,t,a,r){let{data:i}=await n.from("arquivos_demanda").select("status_aprovacao").eq("id",e).single(),s=i?.status_aprovacao||"RASCUNHO",{data:o,error:c}=await n.from("arquivos_demanda").update({status_aprovacao:t,aprovado_por:r||null,aprovado_em:new Date().toISOString(),comentarios_aprovacao:a||null}).eq("id",e).select().single();if(c)throw c;return await n.from("historico_aprovacoes").insert({arquivo_id:e,status_anterior:s,status_novo:t,comentario:a||null,aprovado_por:r||null}),o}async function C(e){let{data:t,error:a}=await n.from("arquivos_demanda").update({status_aprovacao:"EM_REVISAO"}).eq("id",e).select().single();if(a)throw a;return await n.from("historico_aprovacoes").insert({arquivo_id:e,status_anterior:"RASCUNHO",status_novo:"EM_REVISAO"}),t}async function j(e){let{data:t,error:a}=await n.from("historico_aprovacoes").select("*").eq("arquivo_id",e).order("created_at",{ascending:!1});if(a)throw a;return t}(0,r.ensureServerEntryExports)([i,s,o,c,l,d,u,f,p,m,v,h,g,_,b,w,R,E,y,x,S,q,C,j]),(0,t.registerServerReference)(i,"404b748f0b1946809009224a95532ef6f14a9fe75e",null),(0,t.registerServerReference)(s,"4081b83b7434af1baf51baeeaaf1545216e9b463a2",null),(0,t.registerServerReference)(o,"4027a9edcf961ae7b0f5af4b119d41462f5443359c",null),(0,t.registerServerReference)(c,"608ed05da6f063626207bbce3f2bb17e69fdfee246",null),(0,t.registerServerReference)(l,"401e67d38b57b3c4dad7b28a34e7f256632b736dfd",null),(0,t.registerServerReference)(d,"008c67a34b93be7aa0521a8693a859ec5059b72495",null),(0,t.registerServerReference)(u,"00026e1710be57f038693261f67e8e67c5c0b599f8",null),(0,t.registerServerReference)(f,"00f512c64707a4985c37eb46128af65ae3dc4ac475",null),(0,t.registerServerReference)(p,"4076e8c2e387c7d83696aa442105ed9ea5c57c98af",null),(0,t.registerServerReference)(m,"60e4ed39f891cb06e81452a85b435d3c54a93e2073",null),(0,t.registerServerReference)(v,"7085d384e28081877c94ab341cb2e8f016ec35f45c",null),(0,t.registerServerReference)(h,"401617c11f3aca3b7f9934369753b1ce4d78c5f38b",null),(0,t.registerServerReference)(g,"60c46d9d9c884a3b4a65ebcc5a05e6958fed35d7f2",null),(0,t.registerServerReference)(_,"60ae6ae0e8deba2b7fa7d4c1b4430c5a3dfc7e11fb",null),(0,t.registerServerReference)(b,"405509919c95f69114ebfb766c00fc695ee77859f5",null),(0,t.registerServerReference)(w,"00a2bbec07e1f0018a16836a6f409fbd26d68d9481",null),(0,t.registerServerReference)(R,"000bff369587377a3d73106c7a3ebf037e7bb77407",null),(0,t.registerServerReference)(E,"0049fa431e9e9bc33c34dbce28cd1da51b2e19f87c",null),(0,t.registerServerReference)(y,"009dca060ae44a63532f34ca8f39623413b9cdef26",null),(0,t.registerServerReference)(x,"40424572f1d0da9b7a6de176f7add38d4a626c413b",null),(0,t.registerServerReference)(S,"0062f1904ce4b63cebc24b499df92dcd31af7560dd",null),(0,t.registerServerReference)(q,"784d8ae0557d3fd8933ef73f2083cb27299b8d68fb",null),(0,t.registerServerReference)(C,"40add1c4dcaaf328cc92c93e1ceb800b9a1fdd544b",null),(0,t.registerServerReference)(j,"405bd7f003b295234b9b6dae24c76d4f29272046a1",null),e.s(["getDemandas",()=>i,"getNotificacoesPrazos",()=>S])},33167,e=>{"use strict";var t=e.i(59524),a=e.i(76657),r=e.i(83199),n=e.i(97459),i=e.i(95075),s=e.i(47459),o=e.i(58770),c=e.i(30887),l=e.i(48693),d=e.i(75298),u=e.i(14548),f=e.i(21779),p=e.i(72081),m=e.i(95913),v=e.i(1174),h=e.i(93695);e.i(90336);var g=e.i(4464),_=e.i(45443),b=e.i(79292);async function w(){try{let e=await (0,b.getNotificacoesPrazos)();return _.NextResponse.json({notificacoes:e})}catch(e){return console.error("Erro ao buscar notificações:",e),_.NextResponse.json({error:e instanceof Error?e.message:"Erro ao buscar notificações"},{status:500})}}e.s(["GET",()=>w],93983);var R=e.i(93983);let E=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/juridico/notificacoes/route",pathname:"/api/juridico/notificacoes",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/dev/db_ai/src/app/api/juridico/notificacoes/route.ts",nextConfigOutput:"standalone",userland:R}),{workAsyncStorage:y,workUnitAsyncStorage:x,serverHooks:S}=E;function q(){return(0,r.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:x})}async function C(e,t,r){E.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/juridico/notificacoes/route";_=_.replace(/\/index$/,"")||"/";let b=await E.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:R,nextConfig:y,parsedUrl:x,isDraftMode:S,prerenderManifest:q,routerServerContext:C,isOnDemandRevalidate:j,revalidateOnlyGenerated:O,resolvedPathname:A,clientReferenceManifest:N,serverActionsManifest:P}=b,T=(0,o.normalizeAppPath)(_),U=!!(q.dynamicRoutes[T]||q.routes[A]),D=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,x,!1):t.end("This page could not be found"),null);if(U&&!S){let e=!!q.routes[A],t=q.dynamicRoutes[T];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await D();throw new h.NoFallbackError}}let k=null;!U||E.isDev||S||(k="/index"===(k=A)?"/":k);let $=!0===E.isDev||!U,I=U&&!$;P&&N&&(0,s.setManifestsSingleton)({page:_,clientReferenceManifest:N,serverActionsManifest:P});let M=e.method||"GET",H=(0,i.getTracer)(),L=H.getActiveScopeSpan(),F={params:R,prerenderManifest:q,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,n)=>E.onRequestError(e,t,r,n,C)},sharedContext:{buildId:w}},z=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),K=l.NextRequestAdapter.fromNodeNextRequest(z,(0,l.signalFromNodeResponse)(t));try{let s=async e=>E.handle(K,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=H.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${M} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${_}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),c=async n=>{var i,c;let l=async({previousCacheEntry:a})=>{try{if(!o&&j&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let c=F.renderOpts.pendingWaitUntil;c&&r.waitUntil&&(r.waitUntil(c),c=void 0);let l=F.renderOpts.collectedTags;if(!U)return await (0,f.sendResponse)(z,B,i,F.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[v.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:j})},!1,C),t}},d=await E.handleResponse({req:e,nextConfig:y,cacheKey:k,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:q,isRoutePPREnabled:!1,isOnDemandRevalidate:j,revalidateOnlyGenerated:O,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:o});if(!U)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",j?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,p.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&U||h.delete(v.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,f.sendResponse)(z,B,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};L?await c(L):await H.withPropagatedContext(e.headers,()=>H.trace(d.BaseServerSpan.handleRequest,{spanName:`${M} ${_}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},c))}catch(t){if(t instanceof h.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:j})},!1,C),U)throw t;return await (0,f.sendResponse)(z,B,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>q,"routeModule",()=>E,"serverHooks",()=>S,"workAsyncStorage",()=>y,"workUnitAsyncStorage",()=>x],33167)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4d3ca05b._.js.map