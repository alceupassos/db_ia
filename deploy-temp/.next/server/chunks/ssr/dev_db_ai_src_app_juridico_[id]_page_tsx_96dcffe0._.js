module.exports=[40206,a=>{"use strict";var b=a.i(40975),c=a.i(13836),d=a.i(83674);let e=(0,d.createServerReference)("4081b83b7434af1baf51baeeaaf1545216e9b463a2",d.callServer,void 0,d.findSourceMapURL,"getDemandaById"),f=(0,d.createServerReference)("608ed05da6f063626207bbce3f2bb17e69fdfee246",d.callServer,void 0,d.findSourceMapURL,"updateDemanda");var g=a.i(13424),h=a.i(55811),i=a.i(86078);let j=(0,d.createServerReference)("7085d384e28081877c94ab341cb2e8f016ec35f45c",d.callServer,void 0,d.findSourceMapURL,"updateDemandaField"),k=(0,d.createServerReference)("60c46d9d9c884a3b4a65ebcc5a05e6958fed35d7f2",d.callServer,void 0,d.findSourceMapURL,"updateArquivo");var l=a.i(41208),m=a.i(24023),n=a.i(88249),o=a.i(53938),p=a.i(43536),q=a.i(41273),r=a.i(88143),s=a.i(22570),t=a.i(21017),u=a.i(59962),v=a.i(95080),w=a.i(60944),x=c,y=a.i(82431);function z(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}class A extends x.Component{getSnapshotBeforeUpdate(a){let b=this.props.childRef.current;if(b&&a.isPresent&&!this.props.isPresent){let a=b.offsetParent,c=(0,w.isHTMLElement)(a)&&a.offsetWidth||0,d=this.props.sizeRef.current;d.height=b.offsetHeight||0,d.width=b.offsetWidth||0,d.top=b.offsetTop,d.left=b.offsetLeft,d.right=c-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function B({children:a,isPresent:d,anchorX:e,root:f}){let g=(0,x.useId)(),h=(0,x.useRef)(null),i=(0,x.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:j}=(0,x.useContext)(y.MotionConfigContext),k=function(...a){return c.useCallback(function(...a){return b=>{let c=!1,d=a.map(a=>{let d=z(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():z(a[b],null)}}}}(...a),a)}(h,a?.ref);return(0,x.useInsertionEffect)(()=>{let{width:a,height:b,top:c,left:k,right:l}=i.current;if(d||!h.current||!a||!b)return;let m="left"===e?`left: ${k}`:`right: ${l}`;h.current.dataset.motionPopId=g;let n=document.createElement("style");j&&(n.nonce=j);let o=f??document.head;return o.appendChild(n),n.sheet&&n.sheet.insertRule(`
          [data-motion-pop-id="${g}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${b}px !important;
            ${m}px !important;
            top: ${c}px !important;
          }
        `),()=>{o.contains(n)&&o.removeChild(n)}},[d]),(0,b.jsx)(A,{isPresent:d,childRef:h,sizeRef:i,children:x.cloneElement(a,{ref:k})})}let C=({children:a,initial:d,isPresent:e,onExitComplete:f,custom:g,presenceAffectsLayout:h,mode:i,anchorX:j,root:k})=>{let l=(0,t.useConstant)(D),m=(0,c.useId)(),n=!0,o=(0,c.useMemo)(()=>(n=!1,{id:m,initial:d,isPresent:e,custom:g,onExitComplete:a=>{for(let b of(l.set(a,!0),l.values()))if(!b)return;f&&f()},register:a=>(l.set(a,!1),()=>l.delete(a))}),[e,l,f]);return h&&n&&(o={...o}),(0,c.useMemo)(()=>{l.forEach((a,b)=>l.set(b,!1))},[e]),c.useEffect(()=>{e||l.size||!f||f()},[e]),"popLayout"===i&&(a=(0,b.jsx)(B,{isPresent:e,anchorX:j,root:k,children:a})),(0,b.jsx)(v.PresenceContext.Provider,{value:o,children:a})};function D(){return new Map}var E=a.i(65179);let F=a=>a.key||"";function G(a){let b=[];return c.Children.forEach(a,a=>{(0,c.isValidElement)(a)&&b.push(a)}),b}let H=({children:a,custom:d,initial:e=!0,onExitComplete:f,presenceAffectsLayout:g=!0,mode:h="sync",propagate:i=!1,anchorX:j="left",root:k})=>{let[l,m]=(0,E.usePresence)(i),n=(0,c.useMemo)(()=>G(a),[a]),o=i&&!l?[]:n.map(F),p=(0,c.useRef)(!0),q=(0,c.useRef)(n),r=(0,t.useConstant)(()=>new Map),[v,w]=(0,c.useState)(n),[x,y]=(0,c.useState)(n);(0,u.useIsomorphicLayoutEffect)(()=>{p.current=!1,q.current=n;for(let a=0;a<x.length;a++){let b=F(x[a]);o.includes(b)?r.delete(b):!0!==r.get(b)&&r.set(b,!1)}},[x,o.length,o.join("-")]);let z=[];if(n!==v){let a=[...n];for(let b=0;b<x.length;b++){let c=x[b],d=F(c);o.includes(d)||(a.splice(b,0,c),z.push(c))}return"wait"===h&&z.length&&(a=z),y(G(a)),w(n),null}let{forceRender:A}=(0,c.useContext)(s.LayoutGroupContext);return(0,b.jsx)(b.Fragment,{children:x.map(a=>{let c=F(a),s=(!i||!!l)&&(n===x||o.includes(c));return(0,b.jsx)(C,{isPresent:s,initial:(!p.current||!!e)&&void 0,custom:d,presenceAffectsLayout:g,mode:h,root:k,onExitComplete:s?void 0:()=>{if(!r.has(c))return;r.set(c,!0);let a=!0;r.forEach(b=>{b||(a=!1)}),a&&(A?.(),y(q.current),i&&m?.(),f&&f())},anchorX:j,children:a},c)})})};var I=a.i(59373);function J({arquivoId:a,arquivoNome:d,storageUrl:e,onSummaryGenerated:f}){let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),m=async()=>{h(!0),l(null);try{let b=await fetch("/api/juridico/resumir-contrato",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({arquivoId:a,arquivoNome:d,storageUrl:e})});if(!b.ok)throw Error("Erro ao gerar resumo");let c=await b.json();j(c.resumo),f&&f(c.resumo)}catch(a){l(a instanceof Error?a.message:"Erro ao gerar resumo")}finally{h(!1)}};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(q.Button,{onClick:m,disabled:g||!e,variant:"outline",className:"w-full",children:g?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Sparkles,{className:"mr-2 h-4 w-4"}),"Resumir com IA"]})}),(0,b.jsxs)(H,{children:[k&&(0,b.jsx)(I.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-3 bg-destructive/10 text-destructive border border-destructive/20 rounded-lg text-sm",children:k}),i&&(0,b.jsx)(I.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:(0,b.jsx)(r.Card,{children:(0,b.jsxs)(r.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(p.FileText,{className:"h-4 w-4 text-primary"}),(0,b.jsx)("h4",{className:"font-medium",children:"Resumo Gerado pela IA"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:i})]})})})]})]})}var K=a.i(45057),L=a.i(90265);function M({onSearch:a,demandaId:d}){let[e,f]=(0,c.useState)(""),[g,h]=(0,c.useState)(!1),i=async()=>{if(e.trim()){h(!0);try{let b=await fetch("/api/juridico/buscar-semantica",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,demandaId:d})});if(!b.ok)throw Error("Erro na busca");let c=await b.json();a(e,c.results||[])}catch(a){console.error("Erro na busca:",a)}finally{h(!1)}}};return(0,b.jsx)(r.Card,{children:(0,b.jsx)(r.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(K.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,b.jsx)(L.Input,{type:"text",value:e,onChange:a=>f(a.target.value),onKeyPress:a=>"Enter"===a.key&&i(),placeholder:"Busca semântica usando IA...",className:"pl-9"})]}),(0,b.jsx)(q.Button,{onClick:i,disabled:g||!e.trim(),variant:"outline",size:"icon",children:g?(0,b.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(n.Sparkles,{className:"h-4 w-4"})})]})})})}var N=a.i(27926),O=a.i(486);let P=(0,a.i(56618).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var Q=a.i(51419),R=a.i(58572),S=a.i(40686),T=a.i(7280),U=a.i(30685),V=a.i(16877),W=a.i(57529),X=a.i(10221),Y=a.i(89467);function Z({label:a,value:d,type:e="text",onSave:f,className:g,placeholder:h}){let[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(d||""),[m,n]=(0,c.useState)(!1),[p,r]=(0,c.useState)(null),s=async()=>{n(!0),r(null);try{await f(k),j(!1)}catch(a){r(a instanceof Error?a.message:"Erro ao salvar")}finally{n(!1)}};return i?(0,b.jsxs)("div",{className:(0,Y.cn)("space-y-2",g),children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:a}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["textarea"===e?(0,b.jsx)("textarea",{value:k,onChange:a=>l(a.target.value),className:"flex-1 min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:h}):(0,b.jsx)(L.Input,{type:"date"===e?"date":"text",value:"date"===e?(a=>{if(!a)return"";try{return new Date(a).toISOString().split("T")[0]}catch{return a}})(k):k,onChange:a=>l(a.target.value),className:"flex-1",placeholder:h}),(0,b.jsx)(q.Button,{size:"icon",variant:"ghost",onClick:s,disabled:m,className:"h-9 w-9",children:m?(0,b.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin text-primary"}):(0,b.jsx)(W.Check,{className:"h-4 w-4 text-green-500"})}),(0,b.jsx)(q.Button,{size:"icon",variant:"ghost",onClick:()=>{l(d||""),j(!1),r(null)},disabled:m,className:"h-9 w-9",children:(0,b.jsx)(X.X,{className:"h-4 w-4 text-destructive"})})]}),p&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:p})]}):(0,b.jsxs)("div",{className:(0,Y.cn)("space-y-2",g),children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:a}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"flex-1 font-medium",children:"date"===e?(a=>{if(!a)return"";try{return new Date(a).toLocaleDateString("pt-BR")}catch{return a}})(d):d||"-"}),(0,b.jsx)(q.Button,{size:"icon",variant:"ghost",onClick:()=>{l(d||""),j(!0),r(null)},className:"h-8 w-8",children:(0,b.jsx)(V.Pencil,{className:"h-4 w-4 text-muted-foreground"})})]})]})}var $=a.i(94158);function _(){let a=(0,T.useParams)(),d=(0,T.useRouter)(),n=a.id,[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)({}),[E,F]=(0,c.useState)(!1);async function G(){t(!0);try{let[a,b]=await Promise.all([e(n),(0,g.getArquivosByDemanda)(n)]);z(a),D(a),B(b)}catch(a){console.error("Erro ao carregar dados:",a)}finally{t(!1)}}(0,c.useEffect)(()=>{G()},[n]);let H=async()=>{v(!0);try{await f(n,C),z(C),x(!1)}catch(a){alert("Erro ao salvar: "+(a instanceof Error?a.message:"Erro desconhecido"))}finally{v(!1)}},I=async()=>{try{await (0,i.deleteDemanda)(n),d.push("/juridico")}catch(a){alert("Erro ao excluir: "+(a instanceof Error?a.message:"Erro desconhecido"))}},K=async a=>{let b=new FormData;b.append("file",a),await (0,h.uploadArquivo)(n,b),G()};return s?(0,b.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,b.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):y?(0,b.jsxs)("div",{className:"flex-1 space-y-6 p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(S.default,{href:"/juridico",children:(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(N.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsx)("div",{className:"flex-1",children:w?(0,b.jsx)(L.Input,{value:C.demanda||"",onChange:a=>D({...C,demanda:a.target.value}),className:"text-2xl font-bold"}):(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:y.demanda})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(a=>{switch(a){case"CONCLUÍDO":return(0,b.jsx)(U.Badge,{variant:"success",children:"Concluído"});case"EM ANDAMENTO":return(0,b.jsx)(U.Badge,{variant:"warning",children:"Em Andamento"});case"PENDENTE":return(0,b.jsx)(U.Badge,{variant:"error",children:"Pendente"});case"Cancelado":return(0,b.jsx)(U.Badge,{variant:"outline",children:"Cancelado"});default:return(0,b.jsx)(U.Badge,{variant:"outline",children:a})}})(y.status),w?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(q.Button,{onClick:H,disabled:u,size:"sm",children:[u?(0,b.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(O.Save,{className:"mr-2 h-4 w-4"}),"Salvar"]}),(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>{x(!1),D(y||{})},size:"sm",children:"Cancelar"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(q.Button,{variant:"outline",onClick:()=>x(!0),size:"sm",children:[(0,b.jsx)(P,{className:"mr-2 h-4 w-4"}),"Editar"]}),(0,b.jsxs)($.Dialog,{open:E,onOpenChange:F,children:[(0,b.jsx)($.DialogTrigger,{asChild:!0,children:(0,b.jsx)(q.Button,{variant:"destructive",size:"sm",children:(0,b.jsx)(Q.Trash2,{className:"h-4 w-4"})})}),(0,b.jsxs)($.DialogContent,{children:[(0,b.jsxs)($.DialogHeader,{children:[(0,b.jsx)($.DialogTitle,{children:"Excluir Demanda"}),(0,b.jsx)($.DialogDescription,{children:"Tem certeza que deseja excluir esta demanda? Esta ação não pode ser desfeita."})]}),(0,b.jsxs)($.DialogFooter,{children:[(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),(0,b.jsx)(q.Button,{variant:"destructive",onClick:I,children:"Excluir"})]})]})]})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,b.jsxs)(r.Card,{children:[(0,b.jsx)(r.CardHeader,{children:(0,b.jsx)(r.CardTitle,{children:"Informações"})}),(0,b.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsx)(Z,{label:"Cliente",value:y.cliente_nome,onSave:async a=>{await j(n,"cliente_nome",a),await G()}}),(0,b.jsx)(Z,{label:"Responsável",value:y.responsavel,onSave:async a=>{await j(n,"responsavel",a),await G()}}),(0,b.jsx)(Z,{label:"Data de Solicitação",value:y.data_solicitacao,type:"date",onSave:async a=>{await j(n,"data_solicitacao",a||null),await G()}}),(0,b.jsx)(Z,{label:"Prazo",value:y.prazo,type:"date",onSave:async a=>{await j(n,"prazo",a||null),await G()}}),(0,b.jsx)(Z,{label:"Data de Entrega",value:y.data_entrega,type:"date",onSave:async a=>{await j(n,"data_entrega",a||null),await G()}}),(0,b.jsx)(Z,{label:"Data de Pagamento",value:y.data_pagamento,type:"date",onSave:async a=>{await j(n,"data_pagamento",a||null),await G()}}),(0,b.jsx)(Z,{label:"Data Fim de Contrato",value:y.data_fim_contrato,type:"date",onSave:async a=>{await j(n,"data_fim_contrato",a||null),await G()}})]}),(0,b.jsx)("div",{className:"pt-4 border-t",children:(0,b.jsx)(Z,{label:"Observações",value:y.observacoes,type:"textarea",onSave:async a=>{await j(n,"observacoes",a||null),await G()}})})]})]}),(0,b.jsxs)(r.Card,{children:[(0,b.jsx)(r.CardHeader,{children:(0,b.jsxs)(r.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.FileText,{className:"h-5 w-5"}),"Arquivos"]})}),(0,b.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,b.jsx)(m.FileUpload,{onUpload:K,maxSize:10}),A.length>0?(0,b.jsx)("div",{className:"space-y-2 mt-4",children:A.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(Z,{label:"",value:String(a.nome||""),onSave:async b=>{await k(String(a.id||""),{nome:b}),await G()}})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["string"==typeof a.storage_url&&a.storage_url&&(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",onClick:()=>window.open(String(a.storage_url),"_blank"),children:(0,b.jsx)(R.Download,{className:"h-4 w-4"})}),(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",onClick:async()=>{confirm("Tem certeza que deseja excluir este arquivo?")&&(await (0,l.deleteArquivoComStorage)(String(a.id||"")),await G())},children:(0,b.jsx)(Q.Trash2,{className:"h-4 w-4 text-destructive"})})]})]},String(a.id||"")))}):(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Arraste arquivos para a área acima para fazer upload"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(M,{onSearch:(a,b)=>{console.log("Busca:",a,b)},demandaId:n}),A.map(a=>{let c;return(0,b.jsxs)(r.Card,{children:[(0,b.jsx)(r.CardHeader,{children:(0,b.jsx)(r.CardTitle,{className:"text-base",children:String(a.nome||"")})}),(0,b.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,b.jsx)(J,{arquivoId:String(a.id||""),arquivoNome:String(a.nome||""),storageUrl:a.storage_url?String(a.storage_url):void 0}),(c=a.resumo_ia)&&"string"==typeof c?(0,b.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-3",children:c}):null]})]},String(a.id||""))})]})]})]}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,b.jsx)(p.FileText,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Demanda não encontrada"})]})}a.s(["default",()=>_],40206)}];

//# sourceMappingURL=dev_db_ai_src_app_juridico_%5Bid%5D_page_tsx_96dcffe0._.js.map