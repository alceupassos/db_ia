module.exports=[26648,a=>{"use strict";var b=a.i(40975),c=a.i(13836),d=a.i(30297),e=a.i(13424),f=a.i(55811),g=a.i(41208),h=a.i(88143),i=a.i(41273),j=a.i(90265),k=a.i(30685),l=a.i(43536),m=a.i(13976),n=a.i(45057),o=a.i(53938),p=a.i(51419),q=a.i(291),r=a.i(56618);let s=(0,r.default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var t=a.i(68584);let u=(0,r.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),v=(0,r.default)("file",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]]);var w=a.i(58572),x=a.i(24023),y=a.i(88021);function z({arquivo:a}){let[d,e]=(0,c.useState)(!0),[f,g]=(0,c.useState)(!1),h=a.mime_type?.includes("pdf"),j=a.mime_type?.includes("image"),k=a.mime_type?.includes("word")||a.mime_type?.includes("document"),m=()=>{e(!1)},n=()=>{e(!1),g(!0)};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative min-h-[400px] border rounded-lg overflow-hidden bg-muted",children:[d&&!f&&(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80 z-10",children:(0,b.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}),a.url&&!f?(0,b.jsx)(b.Fragment,{children:j?(0,b.jsx)("img",{src:a.url,alt:a.nome,className:"w-full h-auto max-h-[500px] object-contain",onLoad:m,onError:n}):h?(0,b.jsx)("iframe",{src:a.url,className:"w-full h-[500px]",onLoad:m,onError:n}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-[400px]",children:[k&&(0,b.jsx)(v,{className:"h-16 w-16 text-blue-500 mb-4"}),!k&&(0,b.jsx)(v,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Preview não disponível para este tipo de arquivo"}),(0,b.jsxs)(i.Button,{variant:"outline",className:"mt-4",onClick:()=>window.open(a.url,"_blank"),children:[(0,b.jsx)(w.Download,{className:"h-4 w-4 mr-2"}),"Baixar Arquivo"]})]})}):(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-[400px]",children:[h&&(0,b.jsx)(l.FileText,{className:"h-16 w-16 text-red-400 mb-4"}),j&&(0,b.jsx)(u,{className:"h-16 w-16 text-blue-400 mb-4"}),k&&(0,b.jsx)(v,{className:"h-16 w-16 text-blue-500 mb-4"}),!h&&!j&&!k&&(0,b.jsx)(v,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:f?"Erro ao carregar arquivo":"Preview não disponível"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.nome}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.mime_type||"Tipo desconhecido"})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:a.url&&(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>window.open(a.url,"_blank"),children:[(0,b.jsx)(w.Download,{className:"h-4 w-4 mr-2"}),"Baixar"]})})]}),a.resumo_ia&&(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-2",children:"Resumo da IA"}),(0,b.jsx)(y.ScrollArea,{className:"h-[150px]",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:a.resumo_ia})})]})]})}var A=a.i(2510),B=a.i(88249),C=a.i(89467);function D({arquivo:a}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(""),[h,k]=(0,c.useState)(!1),m=(0,c.useRef)(null);(0,c.useEffect)(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[d]);let n=async b=>{if(b.preventDefault(),!f.trim()||h)return;let c={id:Date.now().toString(),role:"user",content:f};e(a=>[...a,c]),g(""),k(!0);try{let b=await fetch("/api/juridico/file-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,arquivoId:a.id,arquivoNome:a.nome,resumoIA:a.resumo_ia,storageUrl:a.storage_url})});if(!b.ok)throw Error("Erro ao processar pergunta");let c=await b.json(),d={id:(Date.now()+1).toString(),role:"assistant",content:c.response};e(a=>[...a,d])}catch(b){console.error("Erro:",b);let a={id:(Date.now()+1).toString(),role:"assistant",content:"Desculpe, ocorreu um erro ao processar sua pergunta. Tente novamente."};e(b=>[...b,a])}finally{k(!1)}};return(0,b.jsxs)("div",{className:"flex flex-col h-[500px]",children:[(0,b.jsxs)("div",{className:"p-3 border-b space-y-2",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:"Perguntas rápidas"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:["Resuma este documento","Quais são os pontos principais?","Identifique riscos ou problemas","Quais são as datas importantes?"].map(a=>(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>g(a),disabled:h,className:"text-xs",children:a},a))})]}),(0,b.jsx)(y.ScrollArea,{className:"flex-1 p-4",ref:m,children:(0,b.jsxs)("div",{className:"space-y-4",children:[0===d.length&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)(l.FileText,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Faça perguntas sobre o arquivo: ",(0,b.jsx)("strong",{children:a.nome})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"A IA pode resumir, analisar e responder dúvidas sobre o conteúdo."})]}),d.map(a=>(0,b.jsxs)("div",{className:(0,C.cn)("flex gap-3","user"===a.role?"justify-end":"justify-start"),children:["assistant"===a.role&&(0,b.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-primary shrink-0",children:(0,b.jsx)(B.Sparkles,{className:"h-4 w-4 text-primary-foreground"})}),(0,b.jsx)("div",{className:(0,C.cn)("rounded-lg px-4 py-2 max-w-[80%]","user"===a.role?"bg-primary text-primary-foreground":"bg-muted text-foreground"),children:(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:a.content})})]},a.id)),h&&(0,b.jsxs)("div",{className:"flex gap-3 justify-start",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-primary shrink-0",children:(0,b.jsx)(B.Sparkles,{className:"h-4 w-4 text-primary-foreground"})}),(0,b.jsx)("div",{className:"rounded-lg px-4 py-2 bg-muted",children:(0,b.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"})})]})]})}),(0,b.jsx)("form",{onSubmit:n,className:"border-t p-4",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(j.Input,{value:f,onChange:a=>g(a.target.value),placeholder:"Pergunte sobre o arquivo...",disabled:h,className:"flex-1"}),(0,b.jsx)(i.Button,{type:"submit",disabled:h||!f.trim(),children:h?(0,b.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(A.Send,{className:"h-4 w-4"})})]})})]})}var E=a.i(45726),F=a.i(94158);function G(){let[a,r]=(0,c.useState)([]),[y,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)("all"),[K,L]=(0,c.useState)("all"),[M,N]=(0,c.useState)("all"),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(""),W=(0,c.useCallback)(async()=>{C(!0);try{let a=await (0,d.getDemandas)();A(a);let b=[];for(let c of a)(await (0,e.getArquivosByDemanda)(c.id)).forEach(a=>{b.push({id:String(a.id||""),nome:String(a.nome||""),tipo:a.tipo?String(a.tipo):null,supabase_path:a.supabase_path?String(a.supabase_path):null,storage_url:a.storage_url?String(a.storage_url):null,mime_type:a.mime_type?String(a.mime_type):null,resumo_ia:a.resumo_ia?String(a.resumo_ia):null,categoria:a.categoria?String(a.categoria):null,descricao_ia:a.descricao_ia?String(a.descricao_ia):null,demanda_id:c.id,demanda_nome:c.demanda,created_at:String(a.created_at||"")})});r(b)}catch(a){console.error("Erro ao carregar dados:",a)}finally{C(!1)}},[]);(0,c.useEffect)(()=>{W()},[W]);let X=async a=>{if(!U)throw Error("Selecione uma demanda para vincular o arquivo");let b=new FormData;b.append("file",a),await (0,f.uploadArquivo)(U,b),W()},Y=async a=>{if(confirm("Tem certeza que deseja excluir este arquivo?"))try{await (0,g.deleteArquivoComStorage)(a),W()}catch(a){console.error("Erro ao excluir arquivo:",a),alert("Erro ao excluir arquivo")}},Z=Array.from(new Set(a.map(a=>a.categoria).filter(a=>"string"==typeof a&&a.length>0))).sort(),$=a.filter(a=>{let b=a.nome.toLowerCase().includes(G.toLowerCase())||a.demanda_nome?.toLowerCase().includes(G.toLowerCase())||a.descricao_ia?.toLowerCase().includes(G.toLowerCase()),c="all"===I||a.demanda_id===I,d="all"===K||"pdf"===K&&a.mime_type?.includes("pdf")||"image"===K&&a.mime_type?.includes("image")||"doc"===K&&(a.mime_type?.includes("word")||a.mime_type?.includes("document")),e="all"===M||a.categoria===M;return b&&c&&d&&e});return(0,b.jsxs)("div",{className:"flex-1 space-y-6 p-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Arquivos"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Gerencie contratos, documentos e arquivos das demandas"})]})}),(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Upload,{className:"h-5 w-5"}),"Adicionar Arquivo"]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)(E.Select,{value:U,onValueChange:V,children:[(0,b.jsx)(E.SelectTrigger,{children:(0,b.jsx)(E.SelectValue,{placeholder:"Selecione a demanda para vincular o arquivo"})}),(0,b.jsx)(E.SelectContent,{children:y.map(a=>(0,b.jsxs)(E.SelectItem,{value:a.id,children:[a.demanda," - ",a.cliente_nome]},a.id))})]})}),(0,b.jsx)(x.FileUpload,{onUpload:X,disabled:!U,maxSize:10})]})]}),(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(j.Input,{placeholder:"Buscar arquivos...",value:G,onChange:a=>H(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(E.Select,{value:I,onValueChange:J,children:[(0,b.jsx)(E.SelectTrigger,{className:"w-full md:w-[200px]",children:(0,b.jsx)(E.SelectValue,{placeholder:"Filtrar por demanda"})}),(0,b.jsxs)(E.SelectContent,{children:[(0,b.jsx)(E.SelectItem,{value:"all",children:"Todas as demandas"}),y.map(a=>(0,b.jsxs)(E.SelectItem,{value:a.id,children:[a.demanda.substring(0,30),"..."]},a.id))]})]}),(0,b.jsxs)(E.Select,{value:K,onValueChange:L,children:[(0,b.jsx)(E.SelectTrigger,{className:"w-full md:w-[150px]",children:(0,b.jsx)(E.SelectValue,{placeholder:"Tipo"})}),(0,b.jsxs)(E.SelectContent,{children:[(0,b.jsx)(E.SelectItem,{value:"all",children:"Todos os tipos"}),(0,b.jsx)(E.SelectItem,{value:"pdf",children:"PDF"}),(0,b.jsx)(E.SelectItem,{value:"image",children:"Imagens"}),(0,b.jsx)(E.SelectItem,{value:"doc",children:"Documentos"})]})]}),(0,b.jsxs)(E.Select,{value:M,onValueChange:N,children:[(0,b.jsx)(E.SelectTrigger,{className:"w-full md:w-[150px]",children:(0,b.jsx)(E.SelectValue,{placeholder:"Categoria"})}),(0,b.jsxs)(E.SelectContent,{children:[(0,b.jsx)(E.SelectItem,{value:"all",children:"Todas as categorias"}),Z.map(a=>(0,b.jsx)(E.SelectItem,{value:a,children:a},a))]})]})]})})}),B?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):0===$.length?(0,b.jsx)(h.Card,{children:(0,b.jsxs)(h.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,b.jsx)(t.FolderOpen,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Nenhum arquivo encontrado"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Selecione uma demanda e arraste um arquivo para fazer upload"})]})}):(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:$.map(a=>{var c;return(0,b.jsx)(h.Card,{className:"hover:border-primary/50 transition-colors",children:(0,b.jsxs)(h.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-muted",children:(c=a.mime_type)?c.includes("pdf")?(0,b.jsx)(l.FileText,{className:"h-5 w-5 text-red-400"}):c.includes("image")?(0,b.jsx)(u,{className:"h-5 w-5 text-blue-400"}):c.includes("word")||c.includes("document")?(0,b.jsx)(v,{className:"h-5 w-5 text-blue-500"}):(0,b.jsx)(v,{className:"h-5 w-5"}):(0,b.jsx)(v,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-medium truncate",title:a.nome,children:a.nome}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.demanda_nome}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[a.categoria&&(0,b.jsx)(k.Badge,{variant:"default",className:"text-xs",children:a.categoria}),a.tipo&&(0,b.jsx)(k.Badge,{variant:"outline",className:"text-xs",children:a.tipo})]})]})]}),a.descricao_ia&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-3 line-clamp-2",title:a.descricao_ia,children:a.descricao_ia}),a.resumo_ia&&!a.descricao_ia&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-3 line-clamp-2",children:a.resumo_ia}),(0,b.jsxs)("div",{className:"flex items-center gap-1 mt-4 pt-4 border-t",children:[(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>{P(a),R(!0)},children:[(0,b.jsx)(q.Eye,{className:"h-4 w-4 mr-1"}),"Ver"]}),(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>{P(a),T(!0)},children:[(0,b.jsx)(s,{className:"h-4 w-4 mr-1"}),"Perguntar"]}),a.storage_url&&(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>window.open(a.storage_url,"_blank"),children:(0,b.jsx)(w.Download,{className:"h-4 w-4"})}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>Y(a.id),className:"text-destructive hover:text-destructive",children:(0,b.jsx)(p.Trash2,{className:"h-4 w-4"})})]})]})},a.id)})}),(0,b.jsx)(F.Dialog,{open:Q,onOpenChange:R,children:(0,b.jsxs)(F.DialogContent,{className:"max-w-4xl max-h-[90vh]",children:[(0,b.jsx)(F.DialogHeader,{children:(0,b.jsx)(F.DialogTitle,{children:O?.nome})}),O&&(0,b.jsx)(z,{arquivo:{...O,url:O.storage_url||void 0}})]})}),(0,b.jsx)(F.Dialog,{open:S,onOpenChange:T,children:(0,b.jsxs)(F.DialogContent,{className:"max-w-2xl max-h-[90vh]",children:[(0,b.jsx)(F.DialogHeader,{children:(0,b.jsxs)(F.DialogTitle,{children:["Perguntar sobre: ",O?.nome]})}),O&&(0,b.jsx)(D,{arquivo:O})]})})]})}a.s(["default",()=>G],26648)}];

//# sourceMappingURL=dev_db_ai_src_app_juridico_arquivos_page_tsx_e878b4be._.js.map