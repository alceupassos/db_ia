module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},85335,(e,t,r)=>{"use strict";var a=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,i={},l={VercelOidcTokenError:()=>u};for(var d in l)a(i,d,{get:l[d],enumerable:!0});t.exports=((e,t,r,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of o(t))s.call(e,r)||void 0===r||a(e,r,{get:()=>t[r],enumerable:!(i=n(t,r))||i.enumerable});return e})(a({},"__esModule",{value:!0}),i);class u extends Error{constructor(e,t){super(e),this.name="VercelOidcTokenError",this.cause=t}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}},12604,e=>{"use strict";var t=e.i(59524),r=e.i(76657),a=e.i(83199),n=e.i(97459),o=e.i(95075),s=e.i(47459),i=e.i(58770),l=e.i(30887),d=e.i(48693),u=e.i(75298),c=e.i(14548),p=e.i(21779),x=e.i(72081),m=e.i(95913),f=e.i(1174),h=e.i(93695);e.i(90336);var v=e.i(4464),R=e.i(45443),g=e.i(58764),E=e.i(14057),O=e.i(68937);let A=(0,g.createOpenAI)({apiKey:process.env.OPENAI_API_KEY}),_=(0,O.createClient)("https://uoqzxsfdxlqpbujsklfn.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),b=`Voc\xea \xe9 a Cepalab IA, assistente jur\xeddica inteligente especializada em an\xe1lise de documentos.

Voc\xea est\xe1 analisando um arquivo/documento espec\xedfico. Use o contexto fornecido para responder \xe0s perguntas do usu\xe1rio sobre este documento.

CAPACIDADES:
- Resumir o conte\xfado do documento
- Identificar pontos principais e cl\xe1usulas importantes
- Detectar riscos, problemas ou inconsist\xeancias
- Extrair datas, valores e informa\xe7\xf5es relevantes
- Explicar termos jur\xeddicos de forma acess\xedvel
- Sugerir melhorias ou pontos de aten\xe7\xe3o

RESTRI\xc7\xd5ES:
- Baseie suas respostas apenas no conte\xfado do documento fornecido
- Se n\xe3o tiver informa\xe7\xe3o suficiente, indique claramente
- N\xe3o invente informa\xe7\xf5es que n\xe3o est\xe3o no documento
- Recomende consulta a advogado para decis\xf5es importantes`;async function w(e){try{let{message:t,arquivoId:r,arquivoNome:a,resumoIA:n,googleDriveId:o}=await e.json();if(!t||!r)return R.NextResponse.json({error:"Mensagem e ID do arquivo são obrigatórios"},{status:400});let s="";n&&(s+=`

RESUMO DO DOCUMENTO (gerado anteriormente pela IA):
${n}`);let{data:i}=await _.from("resumos_contratos").select("resumo, pontos_principais, clausulas_importantes").eq("arquivo_id",r).single();i&&(s+=`

RESUMO DETALHADO DO CONTRATO:
${i.resumo}`,i.pontos_principais&&(s+=`

PONTOS PRINCIPAIS:
${JSON.stringify(i.pontos_principais,null,2)}`),i.clausulas_importantes&&(s+=`

CL\xc1USULAS IMPORTANTES:
${JSON.stringify(i.clausulas_importantes,null,2)}`));let{data:l}=await _.from("arquivos_demanda").select("demanda_id").eq("id",r).single();if(l?.demanda_id){let{data:e}=await _.from("demandas_juridicas").select("demanda, cliente_nome, status, observacoes").eq("id",l.demanda_id).single();e&&(s+=`

CONTEXTO DA DEMANDA ASSOCIADA:
Demanda: ${e.demanda}
Cliente: ${e.cliente_nome}
Status: ${e.status}`,e.observacoes&&(s+=`
Observa\xe7\xf5es: ${e.observacoes}`))}let d=`${b}

ARQUIVO SENDO ANALISADO:
Nome: ${a}
ID: ${r}
${o?`Google Drive ID: ${o}`:""}
${s}

PERGUNTA DO USU\xc1RIO:
${t}

Responda de forma clara e \xfatil, baseando-se no contexto fornecido sobre o documento.`,{text:u}=await (0,E.generateText)({model:A("gpt-4o-mini"),prompt:d,temperature:.7,maxOutputTokens:1500});return R.NextResponse.json({response:u})}catch(e){return console.error("Erro no chat de arquivo:",e),R.NextResponse.json({error:e instanceof Error?e.message:"Erro ao processar pergunta"},{status:500})}}e.s(["POST",()=>w],20464);var C=e.i(20464);let y=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/juridico/file-chat/route",pathname:"/api/juridico/file-chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/dev/db_ai/src/app/api/juridico/file-chat/route.ts",nextConfigOutput:"standalone",userland:C}),{workAsyncStorage:S,workUnitAsyncStorage:N,serverHooks:T}=y;function P(){return(0,a.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:N})}async function j(e,t,a){y.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/juridico/file-chat/route";R=R.replace(/\/index$/,"")||"/";let g=await y.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:E,params:O,nextConfig:A,parsedUrl:_,isDraftMode:b,prerenderManifest:w,routerServerContext:C,isOnDemandRevalidate:S,revalidateOnlyGenerated:N,resolvedPathname:T,clientReferenceManifest:P,serverActionsManifest:j}=g,I=(0,i.normalizeAppPath)(R),D=!!(w.dynamicRoutes[I]||w.routes[T]),q=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,_,!1):t.end("This page could not be found"),null);if(D&&!b){let e=!!w.routes[T],t=w.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await q();throw new h.NoFallbackError}}let $=null;!D||y.isDev||b||($="/index"===($=T)?"/":$);let k=!0===y.isDev||!D,U=D&&!k;j&&P&&(0,s.setManifestsSingleton)({page:R,clientReferenceManifest:P,serverActionsManifest:j});let M=e.method||"GET",H=(0,o.getTracer)(),K=H.getActiveScopeSpan(),L={params:O,prerenderManifest:w,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>y.onRequestError(e,t,a,n,C)},sharedContext:{buildId:E}},V=new l.NodeNextRequest(e),F=new l.NodeNextResponse(t),B=d.NextRequestAdapter.fromNodeNextRequest(V,(0,d.signalFromNodeResponse)(t));try{let s=async e=>y.handle(B,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${R}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!i&&S&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(n);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!D)return await (0,p.sendResponse)(V,F,o,L.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,x.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await y.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:S})},!1,C),t}},u=await y.handleResponse({req:e,nextConfig:A,cacheKey:$,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:w,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:N,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:i});if(!D)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",S?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,x.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&D||h.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(V,F,new Response(u.value.body,{headers:h,status:u.value.status||200})),null};K?await l(K):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${R}`,kind:o.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await y.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:S})},!1,C),D)throw t;return await (0,p.sendResponse)(V,F,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>P,"routeModule",()=>y,"serverHooks",()=>T,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>N],12604)},42800,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__1e5382f7._.js"].map(t=>e.l(t))).then(()=>t(68192)))},43797,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__360155e0._.js"].map(t=>e.l(t))).then(()=>t(30201)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__efa81ef7._.js.map